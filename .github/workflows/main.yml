name: CI

 
on:

  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]


  workflow_dispatch:


jobs:
  build:
    runs-on: ubuntu-latest

    steps:

      - uses: actions/checkout@v2
      
      - name: Install 
        run: npm install
      
      - name: unit-test
        run : npm run unit-tests
        
      - name: integration-test
        run : npm run integration-tests
      
      - name: Test Report unit
        uses: dorny/test-reporter@v1
        if: success() || failure()    # run this step even if previous step failed
        with:
          name: mocha Tests            # Name of the check run which will be created
          path: ./test-results.json    # Path to test results
          reporter: mocha-jeson        # Format of test results

      - name: Depcheck
        uses: dependency-check/Dependency-Check_Action@main
        id: Depcheck
        with:
          project: 'ms-starwars'
          path: '.'
          format: 'HTML'    
          others: ''
      - name: Upload Test results
        uses: actions/upload-artifact@master
        with:
           name: Depcheck report
           path: ${{github.workspace}}/reports
